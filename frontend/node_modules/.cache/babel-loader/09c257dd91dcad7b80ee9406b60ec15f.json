{"ast":null,"code":"import _toConsumableArray from\"/Users/jerome/Desktop/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/jerome/Desktop/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import Header from'./Header';import Main from'./Main';import Footer from'./Footer';import PopupUpdateAvatar from'./PopupUpdateAvatar';import PopupEditProfile from'./PopupEditProfile';import PopupAddCard from'./PopupAddCard';import ImagePopup from'./ImagePopup';import api from\"../utils/Api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import{Route,Routes,Navigate,useNavigate}from'react-router-dom';import RequireAuth from'./RequireAuth';import Login from'./Login';import Register from'./Register';import*as auth from\"../utils/auth\";import InfoTooltip from\"./InfoTooltip\";import iconAppruve from\"../images/iconAppruve.svg\";import iconErr from\"../images/iconErr.svg\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditAvatarPopupOpen=_React$useState2[0],setIsEditAvatarPopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditProfilePopupOpen=_React$useState4[0],setIsEditProfilePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isAddPlacePopupOpen=_React$useState6[0],setIsAddPlacePopupOpen=_React$useState6[1];var _React$useState7=React.useState({}),_React$useState8=_slicedToArray(_React$useState7,2),selectedCard=_React$useState8[0],setSelectedCard=_React$useState8[1];var _React$useState9=React.useState({}),_React$useState10=_slicedToArray(_React$useState9,2),currentUser=_React$useState10[0],setCurrentUser=_React$useState10[1];var _React$useState11=React.useState([]),_React$useState12=_slicedToArray(_React$useState11,2),cards=_React$useState12[0],setCards=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),isInfoTooltipOpen=_React$useState14[0],setIsTooltipOpen=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),loggedIn=_React$useState16[0],setLoggedIn=_React$useState16[1];var _React$useState17=React.useState(''),_React$useState18=_slicedToArray(_React$useState17,2),email=_React$useState18[0],setEmail=_React$useState18[1];var _React$useState19=React.useState({icon:\"\",text:\"\"}),_React$useState20=_slicedToArray(_React$useState19,2),messagePopup=_React$useState20[0],setMessagePopup=_React$useState20[1];var jwt=localStorage.getItem(\"jwt\");var nav=useNavigate();//описание авторизации\nfunction onLogin(_ref){var password=_ref.password,email=_ref.email;return auth.signin({password:password,email:email}).then(function(data){//если получили токен и авторизация прошла успешно\n//то открывается окно подтверждения и переадресовывает на главную страницу\nif(data.token){handleInfoTooltipOpen({icon:iconAppruve,text:\"Вы успешно авторизовались!\"});handleIsTooltipOpen();setEmail(email);setLoggedIn(true);localStorage.setItem('jwt',data.token);localStorage.setItem('email',email);nav('/');}else{handleInfoTooltipOpen({icon:iconErr,text:\"Что-то пошло не так! Попробуйте ещё раз.\"});handleIsTooltipOpen();}}).catch(function(err){console.log(err);});}//описание регистрации\nfunction onRegister(_ref2){var password=_ref2.password,email=_ref2.email;return auth.signup({password:password,email:email}).then(function(data){if(data.data._id){handleInfoTooltipOpen({icon:iconAppruve,text:\"Вы успешно зарегистрировались!\"});handleIsTooltipOpen();nav('/sign-in');}}).catch(function(err){handleInfoTooltipOpen({icon:iconErr,text:\"Что-то пошло не так! Попробуйте ещё раз.\"});handleIsTooltipOpen();console.log(err);});}//состояние данных подтверждения регистрации\nfunction handleInfoTooltipOpen(_ref3){var icon=_ref3.icon,text=_ref3.text;setMessagePopup({icon:icon,text:text});}//выход\nfunction handleSignOut(){setLoggedIn(false);localStorage.removeItem(\"jwt\");localStorage.removeItem('email');setEmail('');nav('/sign-in');}React.useEffect(function(){if(jwt){auth.checkToken(jwt).then(function(data){if(data.data){setEmail(data.data.email);setLoggedIn(true);nav('/');}}).catch(function(err){console.log(err);});}},[]);React.useEffect(function(){if(loggedIn){api.getUserData().then(function(data){setCurrentUser(data);}).catch(function(err){console.log(err);});}},[loggedIn]);React.useEffect(function(){if(loggedIn){api.getCardsData().then(function(data){setCards(data);}).catch(function(err){console.log(err);});}},[loggedIn]);function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});api.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}function handleCardDelete(card){api.deleteCard(card._id).then(function(){var newCard=cards.filter(function(c){return c!==card;});setCards(newCard);}).catch(function(err){console.log(err);});}function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function closeAllPopups(){setIsEditAvatarPopupOpen(false);setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setSelectedCard({isOpen:false});setIsTooltipOpen(false);}function handleIsTooltipOpen(){setIsTooltipOpen(true);}function handleCardClick(card){card.isOpen=!card.isOpen;setSelectedCard(card);}function handleUpdateUser(_ref4){var name=_ref4.name,about=_ref4.about;api.updateUserData({name:name,about:about}).then(function(data){setCurrentUser(data);closeAllPopups();}).catch(function(err){console.log(err);});}function handleUpdateAvatar(_ref5){var avatar=_ref5.avatar;api.updateAvatar(avatar).then(function(data){setCurrentUser(data);closeAllPopups();}).catch(function(err){console.log(err);});}function handleAddPlaceSubmit(_ref6){var name=_ref6.name,link=_ref6.link;api.addCard({name:name,link:link}).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);});}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,email:email,handleSignOut:handleSignOut}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",element:/*#__PURE__*/_jsx(Register,{onRegister:onRegister})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",element:/*#__PURE__*/_jsx(Login,{onLogin:onLogin})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",element:!loggedIn?/*#__PURE__*/_jsx(Navigate,{to:\"/sign-in\"}):/*#__PURE__*/_jsx(Navigate,{to:\"/main\"})}),/*#__PURE__*/_jsx(Route,{path:\"/main\",element:/*#__PURE__*/_jsx(RequireAuth,{loggedIn:loggedIn,children:/*#__PURE__*/_jsx(Main,{onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleCardDelete})})})]}),/*#__PURE__*/_jsx(PopupUpdateAvatar,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateAvatar,buttonText:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(PopupEditProfile,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,buttonText:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(PopupAddCard,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit,buttonText:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoTooltip,{onClose:closeAllPopups,isOpen:isInfoTooltipOpen,messagePopup:messagePopup}),/*#__PURE__*/_jsx(Footer,{})]})});}export default App;","map":{"version":3,"sources":["/Users/jerome/Desktop/dev/react-mesto-auth/src/components/App.js"],"names":["React","Header","Main","Footer","PopupUpdateAvatar","PopupEditProfile","PopupAddCard","ImagePopup","api","CurrentUserContext","Route","Routes","Navigate","useNavigate","RequireAuth","Login","Register","auth","InfoTooltip","App","useState","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","isInfoTooltipOpen","setIsTooltipOpen","loggedIn","setLoggedIn","email","setEmail","icon","text","messagePopup","setMessagePopup","jwt","localStorage","getItem","nav","onLogin","password","signin","then","data","token","handleInfoTooltipOpen","iconAppruve","handleIsTooltipOpen","setItem","iconErr","catch","err","console","log","onRegister","signup","_id","handleSignOut","removeItem","useEffect","checkToken","getUserData","getCardsData","handleCardLike","card","isLiked","likes","some","i","changeLikeCardStatus","newCard","state","map","c","handleCardDelete","deleteCard","filter","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","closeAllPopups","isOpen","handleCardClick","handleUpdateUser","name","about","updateUserData","handleUpdateAvatar","avatar","updateAvatar","handleAddPlaceSubmit","link","addCard"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Header from './Header'\nimport Main from './Main'\nimport Footer from './Footer';\nimport PopupUpdateAvatar from './PopupUpdateAvatar';\nimport PopupEditProfile from './PopupEditProfile';\nimport PopupAddCard from './PopupAddCard';\nimport ImagePopup from './ImagePopup';\nimport api from \"../utils/Api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport { Route, Routes, Navigate, useNavigate } from 'react-router-dom';\nimport RequireAuth from './RequireAuth';\nimport Login from './Login';\nimport Register from './Register';\nimport * as auth from \"../utils/auth\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport iconAppruve from \"../images/iconAppruve.svg\"\nimport iconErr from \"../images/iconErr.svg\"\n\n\nfunction App() {\n\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n  const [isInfoTooltipOpen, setIsTooltipOpen] = React.useState(false)\n\n\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [email, setEmail] = React.useState('');\n  const [messagePopup, setMessagePopup] = React.useState({ icon: \"\", text: \"\" })\n  const jwt = localStorage.getItem(\"jwt\")\n  const nav = useNavigate()\n\n\n\n  //описание авторизации\n  function onLogin({ password, email }) {\n    return auth.signin({ password, email })\n      .then((data) => {\n        //если получили токен и авторизация прошла успешно\n        //то открывается окно подтверждения и переадресовывает на главную страницу\n\n        if (data.token) {\n          handleInfoTooltipOpen({\n            icon: iconAppruve,\n            text: \"Вы успешно авторизовались!\",\n          })\n          handleIsTooltipOpen()\n          setEmail(email);\n          setLoggedIn(true);\n          localStorage.setItem('jwt', data.token);\n          localStorage.setItem('email', email);\n          nav('/');\n        }\n        else {\n          handleInfoTooltipOpen({\n            icon: iconErr,\n            text: \"Что-то пошло не так! Попробуйте ещё раз.\",\n          })\n          handleIsTooltipOpen();\n        }\n      })\n      .catch((err) => {\n        console.log(err)\n      });\n  }\n\n  //описание регистрации\n  function onRegister({ password, email }) {\n    return auth.signup({ password, email })\n      .then((data) => {\n        if (data.data._id) {\n          handleInfoTooltipOpen({\n            icon: iconAppruve,\n            text: \"Вы успешно зарегистрировались!\",\n          })\n          handleIsTooltipOpen()\n          nav('/sign-in')\n        }\n      })\n      .catch((err) => {\n        handleInfoTooltipOpen({\n          icon: iconErr,\n          text: \"Что-то пошло не так! Попробуйте ещё раз.\",\n        })\n        handleIsTooltipOpen();\n        console.log(err)\n      });\n  }\n\n  //состояние данных подтверждения регистрации\n  function handleInfoTooltipOpen({ icon, text }) {\n    setMessagePopup({ icon, text });\n  }\n\n  //выход\n  function handleSignOut() {\n    setLoggedIn(false);\n    localStorage.removeItem(\"jwt\");\n    localStorage.removeItem('email');\n    setEmail('');\n    nav('/sign-in');\n  }\n\n  React.useEffect(() => {\n    if (jwt) {\n      auth.checkToken(jwt)\n        .then((data) => {\n          if (data.data) {\n            setEmail(data.data.email);\n            setLoggedIn(true);\n            nav('/')\n          }\n        })\n        .catch((err) => {\n          console.log(err)\n        });\n    }\n  }, [])\n\n  React.useEffect(() => {\n    if (loggedIn) {\n      api.getUserData()\n      .then((data) => {\n        setCurrentUser(data)\n      })\n      .catch((err) => {\n        console.log(err)\n      });\n    }\n  }, [loggedIn])\n\n  React.useEffect(() => {\n    if (loggedIn) {\n      api.getCardsData()\n      .then((data) => {\n        setCards(data)\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n    }\n  }, [loggedIn])\n\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n\n    api.changeLikeCardStatus(card._id, !isLiked)\n      .then((newCard) => {\n        setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n      })\n      .catch((err) => {\n        console.log(err)\n      });\n  }\n\n\n  function handleCardDelete(card) {\n    api.deleteCard(card._id)\n      .then(() => {\n        const newCard = cards.filter((c) => c !== card);\n        setCards(newCard)\n      })\n      .catch((err) => {\n        console.log(err)\n      });\n  }\n\n\n\n\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true)\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true)\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true)\n  }\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setSelectedCard({ isOpen: false });\n    setIsTooltipOpen(false)\n  }\n\n  function handleIsTooltipOpen() {\n    setIsTooltipOpen(true)\n  }\n\n  function handleCardClick(card) {\n    card.isOpen = !card.isOpen\n    setSelectedCard(card);\n  }\n\n  function handleUpdateUser({ name, about }) {\n    api.updateUserData({ name, about })\n      .then((data) => {\n        setCurrentUser(data)\n        closeAllPopups()\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n\n  }\n\n  function handleUpdateAvatar({ avatar }) {\n    api.updateAvatar(avatar)\n      .then((data) => {\n        setCurrentUser(data)\n        closeAllPopups()\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n  }\n\n  function handleAddPlaceSubmit({ name, link }) {\n    api.addCard({ name, link })\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups()\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n  }\n\n\n\n\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n\n      <div className=\"page\">\n        <Header loggedIn={loggedIn} email={email} handleSignOut={handleSignOut} />\n        <Routes>\n          <Route path=\"/sign-up\" element={<Register onRegister={onRegister} />} />\n          <Route path=\"/sign-in\" element={<Login onLogin={onLogin} />} />\n          <Route exact path=\"/\" element={!loggedIn ? <Navigate to=\"/sign-in\" /> : <Navigate to=\"/main\" />} />\n          <Route path=\"/main\" element={\n            <RequireAuth loggedIn={loggedIn}>\n              <Main\n                onEditProfile={handleEditProfileClick}\n                onAddPlace={handleAddPlaceClick}\n                onEditAvatar={handleEditAvatarClick}\n                onCardClick={handleCardClick}\n                cards={cards}\n                onCardLike={handleCardLike}\n                onCardDelete={handleCardDelete} />\n            </RequireAuth>} />\n        </Routes>\n        <PopupUpdateAvatar\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateUser={handleUpdateAvatar}\n          buttonText=\"Сохранить\" />\n        <PopupEditProfile\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n          onUpdateUser={handleUpdateUser}\n          buttonText=\"Сохранить\" />\n        <PopupAddCard\n          isOpen={isAddPlacePopupOpen}\n          onClose={closeAllPopups}\n          onAddPlace={handleAddPlaceSubmit}\n          buttonText=\"Сохранить\" />\n        <ImagePopup\n          card={selectedCard}\n          onClose={closeAllPopups} />\n        <InfoTooltip\n          onClose={closeAllPopups}\n          isOpen={isInfoTooltipOpen}\n          messagePopup={messagePopup} />\n        <Footer />\n      </div>\n\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}